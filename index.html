<!--Simulador Adivina Quién de Friends con aprendizaje incremental y persistencia en localStorage-->

<!doctype html> <!--archivo HTML5-->
<html lang="es"> <!--Idioma español-->
<head> <!--Metadatos y estilos -->
  <meta charset="utf-8" /> <!--codificación de caracteres-->
  <title>Adivina Quién — Friends </title>
  <meta name="viewport" content="width=device-width,initial-scale=1" /> <!--para móviles, se ajusta al dispositivo-->
  <style>
    body { font-family: Inter, Arial, sans-serif; background:#000000; color:#ffc402; padding:18px; max-width:1000px; margin:auto;}
    header { text-align:center; margin-bottom:12px;}
    h1 { margin:6px 0; font-size:32px;}
    #contenedor { display:flex; gap:16px; flex-wrap:wrap; }
    .panel { background:rgba(255, 255, 255, 0.982); border-radius:8px; padding:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06); flex:1 1 420px; }
    .ficha { display:flex; gap:8px; align-items:center; margin-bottom:8px; border-bottom:1px dashed #eee; padding-bottom:6px;}
    .char { border:1px solid #eee; padding:8px 10px; border-radius:6px; min-width:140px; text-align:left; background:#fff;}
    .controles { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;}
    button { padding:8px 12px; border:none; border-radius:6px; background:#d80707; color:rgb(8, 160, 255); cursor:pointer;}
    button.secondary { background:#6b7280; }
    .registro { background:#0b1220; color:#e6eef8; padding:8px; border-radius:6px; font-size:13px; max-height:220px; overflow:auto;}
    label { display:block; margin-top:8px; font-size:13px; color:#333;}
    input[type=text], select { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; border-radius:6px; border:1px solid #ddd;}
    footer { margin-top:18px; font-size:13px; color:#555;}
    small { color:#666; }
  </style>
</head>
<body>
  <header>
    <h1>Adivina Quién — Friends (Simulador)</h1>
    <div>Simulador educativo con motor de inferencia (encadenamiento hacia adelante) y aprendizaje incremental.</div>
  </header>

  <div id="contenedor">
    <div class="panel">
      <h3>Juego</h3>
      <div id="areaPregunta">Pulsa <strong>Iniciar juego</strong> para comenzar.</div>

      <div class="controles">
        <button id="btnIniciar">Iniciar juego</button>
        <button id="btnPreguntar" class="secondary" disabled>Hacer pregunta</button>
        <button id="btnAdivinar" class="secondary" disabled>Intentar adivinar</button>
        <button id="btnRestaurar" class="secondary">Restaurar conocimiento</button>
      </div>

      <h4 style="margin-top:12px">Registro de acciones</h4>
      <div id="registro" class="registro"></div>
    </div>

    <div class="panel">
      <h3>Candidatos</h3>
      <div id="listaCandidatos"></div>

      <h4 style="margin-top:12px">Agregar / Actualizar personaje</h4>
      <form id="formAgregar">
        <label>Nombre
          <input id="inputNombre" type="text" placeholder="Ej: Janice" required />
        </label>

        <label>Género
          <select id="inputGenero">
            <option value="female">Femenino</option>
            <option value="male">Masculino</option>
          </select>
        </label>

        <label>Color de cabello
          <select id="inputCabello">
            <option value="brown">Café</option>
            <option value="blonde">Rubio</option>
            <option value="black">Negro</option>
            <option value="other">Otro</option>
          </select>
        </label>

        <label>Cabello largo
          <select id="inputLargo">
            <option value="yes">Sí</option>
            <option value="no">No</option>
          </select>
        </label>

        <label>Usa gafas
          <select id="inputGafas">
            <option value="no">No</option>
            <option value="yes">Sí</option>
          </select>
        </label>

        <label>Profesión
          <select id="inputTrabajo">
            <option value="actor">Actor</option>
            <option value="chef">Chef</option>
            <option value="musician">Músico</option>
            <option value="paleontologist">Paleontólogo</option>
            <option value="it">TI</option>
            <option value="fashion">Moda</option>
            <option value="other">Otro</option>
          </select>
        </label>

        <div style="margin-top:10px">
          <button id="btnAgregar" type="submit">Agregar / Actualizar</button>
        </div>
      </form>
    </div>
  </div>

  <footer>
    <strong>Cómo funciona:</strong> el sistema formula preguntas sobre atributos (sí/no) y aplica esos hechos para filtrar candidatos (encadenamiento hacia adelante). Si falla al adivinar, pide que introduzcas los datos del personaje para aprender (persistencia en localStorage).
  </footer>

<script>
/* ------------------------------------------------------------
   Simulador Adivina Quién - Versión en español y corregida
   - KB persistente en localStorage (clave: friends_kb_v1_es)
   - Motor simple de inferencia con encadenamiento hacia adelante
   - Aprendizaje incremental si falla el sistema
   - Interfaz en español y validaciones básicas
   ------------------------------------------------------------ */

// Clave de almacenamiento
const CLAVE_KB = "friends_kb_v1_es";

// Conocimiento inicial (personajes principales de Friends)
const KB_INICIAL = [
  { name: "Rachel", gender:"female", hair:"brown", longHair:"yes", glasses:"no", job:"fashion" },
  { name: "Monica", gender:"female", hair:"brown", longHair:"yes", glasses:"no", job:"chef" },
  { name: "Phoebe", gender:"female", hair:"blonde", longHair:"yes", glasses:"no", job:"musician" },
  { name: "Joey", gender:"male", hair:"brown", longHair:"no", glasses:"no", job:"actor" },
  { name: "Chandler", gender:"male", hair:"brown", longHair:"no", glasses:"no", job:"it" },
  { name: "Ross", gender:"male", hair:"black", longHair:"no", glasses:"no", job:"paleontologist" }
];

// Cargar KB desde localStorage o inicializar
function cargarKB(){
  const raw = localStorage.getItem(CLAVE_KB);
  if(!raw){ localStorage.setItem(CLAVE_KB, JSON.stringify(KB_INICIAL)); return KB_INICIAL.slice(); }
  try { return JSON.parse(raw); }
  catch(e){ localStorage.setItem(CLAVE_KB, JSON.stringify(KB_INICIAL)); return KB_INICIAL.slice(); }
}
function guardarKB(kb){ localStorage.setItem(CLAVE_KB, JSON.stringify(kb)); }

// Estado del juego
let KB = cargarKB();
let candidatos = [];
let hechos = {}; // hechos confirmados: { attr: value } o { attr: "not:value" }
let preguntaActual = null;
let juegoActivo = false;

// Referencias UI
const listaCandidatos = document.getElementById('listaCandidatos');
const registro = document.getElementById('registro');
const areaPregunta = document.getElementById('areaPregunta');
const btnIniciar = document.getElementById('btnIniciar');
const btnPreguntar = document.getElementById('btnPreguntar');
const btnAdivinar = document.getElementById('btnAdivinar');
const btnRestaurar = document.getElementById('btnRestaurar');
const formAgregar = document.getElementById('formAgregar');

// Renderizar candidatos
function renderizarCandidatos(lista){
  listaCandidatos.innerHTML = '';
  lista.forEach(p => {
    const div = document.createElement('div');
    div.className = 'ficha';
    div.innerHTML = `<div class="char"><strong>${p.name}</strong><br><small>${p.gender} · ${p.hair} · ${p.job}</small></div>`;
    listaCandidatos.appendChild(div);
  });
}

// Escribir en registro
function escribirRegistro(texto){
  const d = document.createElement('div');
  d.textContent = `${new Date().toLocaleTimeString()} — ${texto}`;
  registro.prepend(d);
}

// Iniciar juego
btnIniciar.onclick = () => {
  KB = cargarKB();
  candidatos = KB.slice();
  hechos = {};
  preguntaActual = null;
  juegoActivo = true;
  areaPregunta.innerHTML = `<strong>Juego iniciado.</strong> Hay ${candidatos.length} candidatos.`;
  renderizarCandidatos(candidatos);
  escribirRegistro("Juego iniciado. Candidatos: " + candidatos.map(c=>c.name).join(', '));
  btnPreguntar.disabled = false;
  btnAdivinar.disabled = false;
}

// Elegir la mejor pregunta (heurística: elegir atributo con más de un valor y mejor balance)
function elegirPregunta(){
  const atributos = ['gender','hair','longHair','glasses','job'];
  const conteos = {};
  atributos.forEach(a=>{
    conteos[a] = {};
    candidatos.forEach(c => { conteos[a][c[a]] = (conteos[a][c[a]] || 0) + 1; });
  });

  // evitar preguntar atributos ya determinados en hechos (ej: si ya sabemos gender=female)
  const posibles = atributos.filter(a => !Object.keys(hechos).includes(a));
  let mejor = null, mejorScore = Infinity;
  for(const a of posibles){
    const vals = Object.keys(conteos[a]);
    if(vals.length <= 1) continue; // no sirve si todas comparten el mismo valor
    // balance: buscamos que la diferencia entre mayor y menor sea mínima
    const maxC = Math.max(...Object.values(conteos[a]));
    const minC = Math.min(...Object.values(conteos[a]));
    const score = maxC - minC;
    if(score < mejorScore){ mejorScore = score; mejor = a; }
  }
  if(!mejor) return null;
  // elegir el valor más frecuente para ese atributo (para filtrar rápidamente)
  const valCounts = conteos[mejor];
  const masComun = Object.keys(valCounts).sort((x,y)=>valCounts[y]-valCounts[x])[0];
  return { attr: mejor, value: masComun };
}

// Preguntar al usuario
btnPreguntar.onclick = () => {
  if(!juegoActivo){ alert("Inicia el juego primero."); return; }
  preguntaActual = elegirPregunta();
  if(!preguntaActual){
    areaPregunta.innerHTML = "<strong>No hay preguntas útiles restantes.</strong>";
    escribirRegistro("No quedan preguntas útiles.");
    return;
  }
  const texto = `¿El personaje tiene ${preguntaActual.attr} = ${preguntaActual.value}? (responde sí/no)`;
  areaPregunta.innerHTML = `<div>${texto}</div>`;
  escribirRegistro("Pregunta: " + texto);
  let respuesta = prompt(texto);
  if(respuesta === null){ escribirRegistro("El usuario canceló la pregunta."); return; }
  respuesta = respuesta.trim().toLowerCase();
  const positivo = ['si','sí','s','y','yes'].includes(respuesta);
  const attr = preguntaActual.attr;
  const val = preguntaActual.value;
  if(positivo){
    hechos[attr] = val;
    escribirRegistro(`Hecho: ${attr} = ${val}`);
  } else {
    hechos[attr] = "not:"+val;
    escribirRegistro(`Hecho: ${attr} != ${val}`);
  }
  aplicarHechos();
  renderizarCandidatos(candidatos);
  areaPregunta.innerHTML += `<div><em>Candidatos ahora: ${candidatos.length}</em></div>`;

  if(candidatos.length === 1){
    const adiv = candidatos[0];
    const confirma = confirm(`Creo que es ${adiv.name}. ¿Es correcto?`);
    if(confirma){
      escribirRegistro(`Sistema: Adivinó correctamente: ${adiv.name}`);
      alert("¡He adivinado!");
      juegoActivo = false; btnPreguntar.disabled = true; btnAdivinar.disabled = true;
    } else {
      escribirRegistro("Sistema: Adivinó mal.");
      gestionarAprendizaje();
    }
  } else if(candidatos.length === 0){
    escribirRegistro("No quedan candidatos después de aplicar hechos. Se requiere aprendizaje.");
    gestionarAprendizaje();
  }
}

// Aplicar hechos (encadenamiento hacia adelante simple)
function aplicarHechos(){
  candidatos = KB.filter(p => {
    for(const [attr, val] of Object.entries(hechos)){
      if(typeof val === 'string' && val.startsWith("not:")){
        const v = val.slice(4);
        if(p[attr] === v) return false;
      } else {
        if(p[attr] != val) return false;
      }
    }
    return true;
  });
}

// Intento manual de adivinar por parte del usuario
btnAdivinar.onclick = () => {
  if(!juegoActivo){ alert("Inicia el juego primero."); return; }
  const nombre = prompt("¿A quién quieres adivinar? (Escribe el nombre exacto)");
  if(!nombre) return;
  const encontrado = KB.find(p => p.name.toLowerCase() === nombre.trim().toLowerCase());
  if(!encontrado){ alert("No conozco a ese personaje. Voy a pedir que lo enseñes."); gestionarAprendizaje(nombre); return; }
  const confirma = confirm(`¿Tu personaje es ${encontrado.name}?`);
  if(confirma){
    escribirRegistro("Usuario confirmó personaje: " + encontrado.name);
    alert("¡Perfecto! Confirmado.");
    juegoActivo = false; btnPreguntar.disabled = true; btnAdivinar.disabled = true;
  } else {
    escribirRegistro("Usuario dijo que no: " + encontrado.name);
    alert("No adiviné. Aprenderé ese personaje.");
    gestionarAprendizaje();
  }
}

// Aprendizaje: pedir datos del personaje y guardar en KB
function gestionarAprendizaje(nombreConocido){
  const nombre = nombreConocido || prompt("¿Cuál era el personaje correcto? (Escribe el nombre)");
  if(!nombre){ escribirRegistro("Aprendizaje cancelado."); return; }
  const genero = prompt("Género (female/male)", "female") || "female";
  const cabello = prompt("Cabello (brown/blonde/black/other)", "brown") || "brown";
  const largo = prompt("Cabello largo? (yes/no)", "no") || "no";
  const gafas = prompt("¿Usa gafas? (yes/no)", "no") || "no";
  const trabajo = prompt("Profesión (actor/chef/musician/paleontologist/it/fashion/other)", "other") || "other";

  const existe = KB.find(p => p.name.toLowerCase() === nombre.trim().toLowerCase());
  if(existe){
    existe.gender = genero; existe.hair = cabello; existe.longHair = largo; existe.glasses = gafas; existe.job = trabajo;
    escribirRegistro("Conocimiento actualizado para: " + nombre);
  } else {
    KB.push({ name: nombre, gender: genero, hair: cabello, longHair: largo, glasses: gafas, job: trabajo });
    escribirRegistro("Aprendido nuevo personaje: " + nombre);
  }
  guardarKB(KB);
  // Reiniciar estado de juego
  candidatos = KB.slice(); hechos = {}; preguntaActual = null;
  renderizarCandidatos(candidatos);
  areaPregunta.innerHTML = "<strong>He aprendido. Reinicia el juego para jugar otra vez.</strong>";
  juegoActivo = false; btnPreguntar.disabled = true; btnAdivinar.disabled = true;
}

// Formulario para agregar/actualizar personajes manualmente
formAgregar.onsubmit = (e) => {
  e.preventDefault();
  const nombre = document.getElementById('inputNombre').value.trim();
  if(!nombre) return alert("Nombre requerido");
  const genero = document.getElementById('inputGenero').value;
  const cabello = document.getElementById('inputCabello').value;
  const largo = document.getElementById('inputLargo').value;
  const gafas = document.getElementById('inputGafas').value;
  const trabajo = document.getElementById('inputTrabajo').value;
  const existe = KB.find(p => p.name.toLowerCase() === nombre.toLowerCase());
  if(existe){
    existe.gender = genero; existe.hair = cabello; existe.longHair = largo; existe.glasses = gafas; existe.job = trabajo;
    escribirRegistro("Personaje actualizado: " + nombre);
  } else {
    KB.push({ name: nombre, gender: genero, hair: cabello, longHair: largo, glasses: gafas, job: trabajo });
    escribirRegistro("Personaje agregado: " + nombre);
  }
  guardarKB(KB);
  renderizarCandidatos(KB);
  formAgregar.reset();
}

// Restaurar conocimiento inicial
btnRestaurar.onclick = () => {
  if(!confirm("¿Restaurar el conocimiento inicial? Se perderán los personajes aprendidos.")) return;
  localStorage.removeItem(CLAVE_KB);
  KB = cargarKB();
  candidatos = KB.slice();
  hechos = {};
  renderizarCandidatos(KB);
  escribirRegistro("Conocimiento restaurado a valores iniciales.");
  areaPregunta.innerHTML = "Conocimiento restaurado. Inicia el juego cuando quieras.";
  juegoActivo = false; btnPreguntar.disabled = true; btnAdivinar.disabled = true;
}

// Inicializar vista
renderizarCandidatos(KB);
escribirRegistro("KB cargada. Pulsa Iniciar juego para comenzar.");

</script>
</body>
</html>

