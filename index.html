<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Adivina Qui√©n ‚Äî Friends (Aprendizaje Mejorado)</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 25px; color: #111827; }
  h1 { color: #2563eb; }
  button { margin: 6px; padding: 10px 15px; border: none; border-radius: 6px; background: #3b82f6; color: white; cursor: pointer; }
  button:hover { background: #2563eb; }
  #log { background: #111827; color: #f3f4f6; padding: 10px; border-radius: 8px; max-height: 250px; overflow-y: auto; }
  #pregunta { margin: 15px 0; font-weight: bold; color: #1e40af; }
  #opcionesRespuesta button { background: #10b981; }
  #opcionesRespuesta button.no { background: #ef4444; }
</style>
</head>
<body>

<h1>Adivina Qui√©n ‚Äî Friends üëÄ</h1>
<p>El sistema intentar√° adivinar qu√© personaje de <b>Friends</b> est√°s pensando.  
Si no lo conoce, aprender√° autom√°ticamente para la pr√≥xima vez.</p>

<button id="btnIniciar">Iniciar juego</button>
<button id="btnPreguntar" disabled>Hacer pregunta</button>
<button id="btnAprender">Agregar personaje nuevo</button>

<div id="pregunta"></div>
<div id="opcionesRespuesta" style="display:none;">
  <button id="btnSi">‚úÖ S√≠</button>
  <button id="btnNo" class="no">‚ùå No</button>
</div>

<h3>Registro del sistema:</h3>
<div id="log"></div>

<script>
function cargarPersonajes() {
  const guardados = localStorage.getItem("personajes_friends");
  if (guardados) return JSON.parse(guardados);
  return [
    { nombre: "Rachel", g√©nero: "femenino", cabello: "casta√±o", profesi√≥n: "moda", personalidad: "rom√°ntica" },
    { nombre: "Monica", g√©nero: "femenino", cabello: "negro", profesi√≥n: "chef", personalidad: "competitiva" },
    { nombre: "Phoebe", g√©nero: "femenino", cabello: "rubio", profesi√≥n: "m√∫sica", personalidad: "so√±adora" },
    { nombre: "Ross", g√©nero: "masculino", cabello: "negro", profesi√≥n: "paleont√≥logo", personalidad: "serio" },
    { nombre: "Joey", g√©nero: "masculino", cabello: "casta√±o", profesi√≥n: "actor", personalidad: "divertido" },
    { nombre: "Chandler", g√©nero: "masculino", cabello: "casta√±o", profesi√≥n: "oficina", personalidad: "sarc√°stico" }
  ];
}

let personajes = cargarPersonajes();

let reglas = [
  { atributo: "g√©nero", pregunta: v => `¬øTu personaje es ${v}?` },
  { atributo: "cabello", pregunta: v => `¬øTu personaje tiene el cabello ${v}?` },
  { atributo: "profesi√≥n", pregunta: v => `¬øTu personaje trabaja en ${v}?` },
  { atributo: "personalidad", pregunta: v => `¬øTu personaje es ${v}?` }
];

class MotorInferencia {
  constructor(personajes, reglas) {
    this.personajes = [...personajes];
    this.reglas = reglas;
    this.hechos = {};
    this.log = [];
    this.personajeAdivinado = null;
  }

  registrar(texto) {
    this.log.unshift(texto);
    document.getElementById("log").innerHTML = this.log.map(l => `<div>${l}</div>`).join("");
  }

  seleccionarRegla() {
    const noAplicadas = this.reglas.filter(r => !(r.atributo in this.hechos));
    return noAplicadas.length ? noAplicadas[Math.floor(Math.random() * noAplicadas.length)] : null;
  }

  aplicarHecho(atributo, valor) {
    this.hechos[atributo] = valor;
    this.personajes = this.personajes.filter(p => p[atributo] === valor);
    this.registrar(`Hecho: ${atributo} = ${valor}`);
  }

  hacerPregunta() {
    const preguntaDiv = document.getElementById("pregunta");
    const opcionesDiv = document.getElementById("opcionesRespuesta");
    opcionesDiv.style.display = "none";

    if (this.personajes.length === 1) {
      const adivina = this.personajes[0].nombre;
      this.personajeAdivinado = adivina;
      preguntaDiv.textContent = `üéØ Creo que es ${adivina}. ¬øEs correcto?`;
      opcionesDiv.style.display = "block";
      this.registrar(`Posible personaje: ${adivina}`);
      return;
    }

    if (this.personajes.length === 0) {
      this.registrar("‚ùå No encontr√© coincidencias. Aprender√© un nuevo personaje...");
      this.aprenderNuevo();
      return;
    }

    const regla = this.seleccionarRegla();
    if (!regla) {
      this.registrar("No hay m√°s preguntas posibles.");
      this.aprenderNuevo();
      return;
    }

    const valores = [...new Set(this.personajes.map(p => p[regla.atributo]))];
    const valor = valores[Math.floor(Math.random() * valores.length)];
    const pregunta = regla.pregunta(valor);
    preguntaDiv.textContent = pregunta;

    const respuesta = confirm(pregunta + " (Aceptar = S√≠, Cancelar = No)");
    if (respuesta) {
      this.personajes = this.personajes.filter(p => p[regla.atributo] === valor);
    } else {
      this.personajes = this.personajes.filter(p => p[regla.atributo] !== valor);
    }

    this.hacerPregunta();
  }

  aprenderNuevo() {
    this.registrar("üß† Modo aprendizaje activado.");
    const nombre = prompt("¬øCu√°l era el personaje que pensabas?");
    if (!nombre) return;

    let nuevo = { nombre: nombre.trim() };
    this.registrar(`Aprendiendo personaje: ${nuevo.nombre}`);

    this.reglas.forEach(r => {
      let valor = prompt(`¬øCu√°l es el valor de '${r.atributo}' para ${nuevo.nombre}?`);
      nuevo[r.atributo] = valor ? valor.toLowerCase().trim() : "";
    });

    personajes.push(nuevo);
    localStorage.setItem("personajes_friends", JSON.stringify(personajes));

    this.registrar(`‚úÖ Personaje aprendido: ${nuevo.nombre}`);
    alert(`He aprendido un nuevo personaje: ${nuevo.nombre}!`);
  }
}

// ----- Control principal -----
let motor = new MotorInferencia(personajes, reglas);

document.getElementById("btnIniciar").onclick = () => {
  motor = new MotorInferencia(personajes, reglas);
  motor.registrar("üéÆ Juego iniciado.");
  document.getElementById("btnPreguntar").disabled = false;
  document.getElementById("pregunta").textContent = "";
};

document.getElementById("btnPreguntar").onclick = () => motor.hacerPregunta();

document.getElementById("btnAprender").onclick = () => motor.aprenderNuevo();

document.getElementById("btnSi").onclick = () => {
  motor.registrar(`‚úÖ Confirmado: era ${motor.personajeAdivinado}`);
  alert(`¬°Genial! Sab√≠a que era ${motor.personajeAdivinado} üòÑ`);
  document.getElementById("opcionesRespuesta").style.display = "none";
};

document.getElementById("btnNo").onclick = () => {
  motor.registrar(`‚ùå Fall√©, no era ${motor.personajeAdivinado}. Aprender√© qui√©n era.`);
  document.getElementById("opcionesRespuesta").style.display = "none";
  motor.aprenderNuevo();
};
</script>
</body>
</html>
