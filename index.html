<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Adivina QuiÃ©n â€” Friends (VersiÃ³n con Reinicio)</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 25px; color: #111827; }
  h1 { color: #2563eb; }
  button { margin: 6px; padding: 10px 15px; border: none; border-radius: 6px; background: #3b82f6; color: white; cursor: pointer; }
  button:hover { background: #2563eb; }
  #log { background: #111827; color: #f3f4f6; padding: 10px; border-radius: 8px; max-height: 250px; overflow-y: auto; }
  #pregunta { margin: 15px 0; font-weight: bold; color: #1e40af; }
  #opcionesRespuesta button { background: #10b981; }
  #opcionesRespuesta button.no { background: #ef4444; }
  #botones { margin-bottom: 15px; }
</style>
</head>
<body>

<h1>Adivina QuiÃ©n â€” Friends ğŸ‘€</h1>
<p>El sistema intentarÃ¡ adivinar quÃ© personaje de <b>Friends</b> estÃ¡s pensando.  
Si no lo conoce, aprenderÃ¡ automÃ¡ticamente para la prÃ³xima vez.</p>

<div id="botones">
  <button id="btnIniciar">Iniciar juego</button>
  <button id="btnPreguntar" disabled>Hacer pregunta</button>
  <button id="btnAprender">Agregar personaje nuevo</button>
  <button id="btnReset">ğŸ”„ Reiniciar aprendizaje</button>
</div>

<div id="pregunta"></div>
<div id="opcionesRespuesta" style="display:none;">
  <button id="btnSi">âœ… SÃ­</button>
  <button id="btnNo" class="no">âŒ No</button>
</div>

<h3>Registro del sistema:</h3>
<div id="log"></div>

<script>
function personajesBase() {
  return [
    { nombre: "Rachel", gÃ©nero: "femenino", cabello: "castaÃ±o", profesiÃ³n: "moda", personalidad: "romÃ¡ntica" },
    { nombre: "Monica", gÃ©nero: "femenino", cabello: "negro", profesiÃ³n: "chef", personalidad: "competitiva" },
    { nombre: "Phoebe", gÃ©nero: "femenino", cabello: "rubio", profesiÃ³n: "mÃºsica", personalidad: "soÃ±adora" },
    { nombre: "Ross", gÃ©nero: "masculino", cabello: "negro", profesiÃ³n: "paleontÃ³logo", personalidad: "serio" },
    { nombre: "Joey", gÃ©nero: "masculino", cabello: "castaÃ±o", profesiÃ³n: "actor", personalidad: "divertido" },
    { nombre: "Chandler", gÃ©nero: "masculino", cabello: "castaÃ±o", profesiÃ³n: "oficina", personalidad: "sarcÃ¡stico" }
  ];
}

function cargarPersonajes() {
  const guardados = localStorage.getItem("personajes_friends");
  if (guardados) return JSON.parse(guardados);
  return personajesBase();
}

let personajes = cargarPersonajes();

let reglas = [
  { atributo: "gÃ©nero", pregunta: v => `Â¿Tu personaje es ${v}?` },
  { atributo: "cabello", pregunta: v => `Â¿Tu personaje tiene el cabello ${v}?` },
  { atributo: "profesiÃ³n", pregunta: v => `Â¿Tu personaje trabaja en ${v}?` },
  { atributo: "personalidad", pregunta: v => `Â¿Tu personaje es ${v}?` }
];

class MotorInferencia {
  constructor(personajes, reglas) {
    this.personajes = [...personajes];
    this.reglas = reglas;
    this.hechos = {};
    this.log = [];
    this.personajeAdivinado = null;
  }

  registrar(texto) {
    this.log.unshift(texto);
    document.getElementById("log").innerHTML = this.log.map(l => `<div>${l}</div>`).join("");
  }

  seleccionarRegla() {
    const noAplicadas = this.reglas.filter(r => !(r.atributo in this.hechos));
    return noAplicadas.length ? noAplicadas[Math.floor(Math.random() * noAplicadas.length)] : null;
  }

  hacerPregunta() {
    const preguntaDiv = document.getElementById("pregunta");
    const opcionesDiv = document.getElementById("opcionesRespuesta");
    opcionesDiv.style.display = "none";

    if (this.personajes.length === 1) {
      const adivina = this.personajes[0].nombre;
      this.personajeAdivinado = adivina;
      preguntaDiv.textContent = `ğŸ¯ Creo que es ${adivina}. Â¿Es correcto?`;
      opcionesDiv.style.display = "block";
      this.registrar(`Posible personaje: ${adivina}`);
      return;
    }

    if (this.personajes.length === 0) {
      this.registrar("âŒ No encontrÃ© coincidencias. AprenderÃ© un nuevo personaje...");
      this.aprenderNuevo();
      return;
    }

    const regla = this.seleccionarRegla();
    if (!regla) {
      this.registrar("No hay mÃ¡s preguntas posibles.");
      this.aprenderNuevo();
      return;
    }

    const valores = [...new Set(this.personajes.map(p => p[regla.atributo]))];
    const valor = valores[Math.floor(Math.random() * valores.length)];
    const pregunta = regla.pregunta(valor);
    const respuesta = confirm(pregunta + " (Aceptar = SÃ­, Cancelar = No)");

    if (respuesta) {
      this.personajes = this.personajes.filter(p => p[regla.atributo] === valor);
    } else {
      this.personajes = this.personajes.filter(p => p[regla.atributo] !== valor);
    }

    this.hacerPregunta();
  }

  aprenderNuevo() {
    this.registrar("ğŸ§  Modo aprendizaje activado.");
    const nombre = prompt("Â¿CuÃ¡l era el personaje que pensabas?");
    if (!nombre) return;

    let nuevo = { nombre: nombre.trim() };
    this.registrar(`Aprendiendo personaje: ${nuevo.nombre}`);

    this.reglas.forEach(r => {
      let valor = prompt(`Â¿CuÃ¡l es el valor de '${r.atributo}' para ${nuevo.nombre}?`);
      nuevo[r.atributo] = valor ? valor.toLowerCase().trim() : "";
    });

    personajes.push(nuevo);
    localStorage.setItem("personajes_friends", JSON.stringify(personajes));

    this.registrar(`âœ… Personaje aprendido: ${nuevo.nombre}`);
    alert(`He aprendido un nuevo personaje: ${nuevo.nombre}!`);
  }
}

// ----- Control principal -----
let motor = new MotorInferencia(personajes, reglas);

document.getElementById("btnIniciar").onclick = () => {
  motor = new MotorInferencia(personajes, reglas);
  motor.registrar("ğŸ® Juego iniciado.");
  document.getElementById("btnPreguntar").disabled = false;
  document.getElementById("pregunta").textContent = "";
};

document.getElementById("btnPreguntar").onclick = () => motor.hacerPregunta();

document.getElementById("btnAprender").onclick = () => motor.aprenderNuevo();

document.getElementById("btnSi").onclick = () => {
  motor.registrar(`âœ… Confirmado: era ${motor.personajeAdivinado}`);
  alert(`Â¡Genial! SabÃ­a que era ${motor.personajeAdivinado} ğŸ˜„`);
  document.getElementById("opcionesRespuesta").style.display = "none";
};

document.getElementById("btnNo").onclick = () => {
  motor.registrar(`âŒ FallÃ©, no era ${motor.personajeAdivinado}. AprenderÃ© quiÃ©n era.`);
  document.getElementById("opcionesRespuesta").style.display = "none";
  motor.aprenderNuevo();
};

// ğŸ§¹ Reiniciar aprendizaje
document.getElementById("btnReset").onclick = () => {
  if (confirm("Â¿Seguro que quieres borrar todo y reiniciar el conocimiento?")) {
    localStorage.removeItem("personajes_friends");
    personajes = personajesBase();
    alert("âœ… Base de conocimiento reiniciada. Ahora solo conoce a los 6 personajes originales.");
    location.reload();
  }
};
</script>
</body>
</html>
