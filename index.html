<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Adivina Qui√©n ‚Äî Friends (Versi√≥n Aprendizaje en Espa√±ol)</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f9fafb; padding: 20px; color: #1f2937; }
  #log { background: #111827; color: #e5e7eb; padding: 10px; border-radius: 8px; max-height: 250px; overflow:auto; }
  button { margin: 8px; padding: 10px 15px; border: none; border-radius: 6px; background: #3b82f6; color: white; cursor: pointer; font-weight: 500; }
  button:hover { background: #2563eb; }
  h1 { color: #2563eb; }
</style>
</head>
<body>
<h1>Adivina Qui√©n ‚Äî Friends (Versi√≥n Aprendizaje en Espa√±ol)</h1>

<p>Juego de inferencia con aprendizaje autom√°tico.  
El sistema intentar√° adivinar tu personaje de <b>Friends</b> y aprender√° nuevos si no lo conoce.</p>

<button id="btnIniciar">Iniciar Juego</button>
<button id="btnPreguntar" disabled>Hacer Pregunta</button>
<button id="btnAprender">Agregar Personaje Nuevo</button>

<div id="pregunta"></div>
<h3>Registro:</h3>
<div id="log"></div>

<script>
/* ------------------------------
   Cargar base de conocimiento
------------------------------ */
function cargarPersonajes() {
  const guardados = localStorage.getItem("personajes_friends");
  if (guardados) return JSON.parse(guardados);
  return [
    { nombre: "Rachel", g√©nero: "femenino", cabello: "casta√±o", profesi√≥n: "moda", personalidad: "rom√°ntica" },
    { nombre: "Monica", g√©nero: "femenino", cabello: "negro", profesi√≥n: "chef", personalidad: "competitiva" },
    { nombre: "Phoebe", g√©nero: "femenino", cabello: "rubio", profesi√≥n: "m√∫sica", personalidad: "so√±adora" },
    { nombre: "Ross", g√©nero: "masculino", cabello: "negro", profesi√≥n: "paleont√≥logo", personalidad: "serio" },
    { nombre: "Joey", g√©nero: "masculino", cabello: "casta√±o", profesi√≥n: "actor", personalidad: "divertido" },
    { nombre: "Chandler", g√©nero: "masculino", cabello: "casta√±o", profesi√≥n: "oficina", personalidad: "sarc√°stico" }
  ];
}

let personajes = cargarPersonajes();

/* ------------------------------
   Reglas en espa√±ol
------------------------------ */
let reglas = [
  { atributo: "g√©nero", pregunta: v => `¬øTu personaje es ${v}?` },
  { atributo: "cabello", pregunta: v => `¬øTu personaje tiene el cabello ${v}?` },
  { atributo: "profesi√≥n", pregunta: v => `¬øTu personaje trabaja en ${v}?` },
  { atributo: "personalidad", pregunta: v => `¬øTu personaje es ${v}?` }
];

/* ------------------------------
   Motor de inferencia
------------------------------ */
class MotorInferencia {
  constructor(personajes, reglas) {
    this.personajes = [...personajes];
    this.reglas = reglas;
    this.hechos = {};
    this.log = [];
  }

  registrar(texto) {
    this.log.unshift(texto);
    document.getElementById("log").innerHTML = this.log.map(l => `<div>${l}</div>`).join("");
  }

  seleccionarRegla() {
    const noAplicadas = this.reglas.filter(r => !(r.atributo in this.hechos));
    return noAplicadas.length ? noAplicadas[Math.floor(Math.random() * noAplicadas.length)] : null;
  }

  aplicarHecho(atributo, valor) {
    this.hechos[atributo] = valor;
    this.personajes = this.personajes.filter(p => p[atributo] === valor);
    this.registrar(`Hecho aprendido: ${atributo} = ${valor}`);
  }

  async hacerPregunta() {
    if (this.personajes.length === 1) {
      const adivina = this.personajes[0].nombre;
      this.registrar(`üéØ ¬°Adivin√©! Es ${adivina}`);
      alert(`Creo que es ${adivina}.`);
      return;
    }

    if (this.personajes.length === 0) {
      this.registrar("‚ùå No encontr√© coincidencias. Aprender√© un nuevo personaje...");
      await this.aprenderNuevo();
      return;
    }

    const regla = this.seleccionarRegla();
    if (!regla) {
      this.registrar("No hay m√°s preguntas aplicables.");
      await this.aprenderNuevo();
      return;
    }

    const valores = [...new Set(this.personajes.map(p => p[regla.atributo]))];
    const valor = valores[Math.floor(Math.random() * valores.length)];
    const pregunta = regla.pregunta(valor);

    this.registrar(`Pregunta: ${pregunta}`);
    document.getElementById("pregunta").textContent = pregunta;

    let respuesta = prompt(pregunta + " (s√≠/no)");
    if (!respuesta) return;
    respuesta = respuesta.toLowerCase();

    const mapa = { "s√≠": true, "si": true, "s": true, "no": false, "n": false };
    const afirmativo = mapa[respuesta] ?? false;

    this.personajes = this.personajes.filter(p =>
      afirmativo ? p[regla.atributo] === valor : p[regla.atributo] !== valor
    );

    if (this.personajes.length <= 1) await this.hacerPregunta();
  }

  async aprenderNuevo() {
    this.registrar("üß† Modo aprendizaje activado.");
    const nombre = prompt("¬øCu√°l era el personaje que pensabas?");
    if (!nombre) return;

    let nuevo = { nombre: nombre.trim() };
    this.registrar(`Aprendiendo nuevo personaje: ${nuevo.nombre}`);

    this.reglas.forEach(r => {
      let valor = prompt(`¬øCu√°l es el valor de '${r.atributo}' para ${nuevo.nombre}?`);
      nuevo[r.atributo] = valor ? valor.toLowerCase().trim() : "";
    });

    personajes.push(nuevo);
    localStorage.setItem("personajes_friends", JSON.stringify(personajes));

    this.registrar(`‚úÖ Nuevo personaje aprendido: ${nuevo.nombre}`);
    alert(`He aprendido un nuevo personaje: ${nuevo.nombre}!`);
  }
}

/* ------------------------------
   Controlador principal
------------------------------ */
let motor = new MotorInferencia(personajes, reglas);

document.getElementById("btnIniciar").onclick = () => {
  motor = new MotorInferencia(personajes, reglas);
  motor.registrar("üéÆ Juego iniciado.");
  document.getElementById("btnPreguntar").disabled = false;
};

document.getElementById("btnPreguntar").onclick = () => motor.hacerPregunta();

document.getElementById("btnAprender").onclick = () => motor.aprenderNuevo();
</script>
</body>
</html>
